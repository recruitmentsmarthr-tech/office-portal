<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <title>Agentic Workspace | PTA Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --accent: #007bff; --neon: #32ff7e; --bg: #0a0a0a; }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direct>

        /* Top Bar */
        .header { background: #151515; padding: 15px 25px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-betwee>
        .controls { display: flex; gap: 12px; }
        input[type="file"] { background: #222; border: 1px solid #444; color: #aaa; padding: 8px; border-radius: 5px; font-size: 13px; }

        button { border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; }
        button:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-outline { background: transparent; border: 1px solid #444; color: #ccc; }

        /* Progress Bar */
        .progress-container { width: 100%; height: 4px; background: #222; }
        #progress-bar { width: 0%; height: 100%; background: var(--accent); box-shadow: 0 0 10px var(--accent); transition: 0.5s; }

        /* Main View */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        .panel { width: 50%; display: flex; flex-direction: column; overflow: hidden; }
        .panel-left { border-right: 1px solid #333; background: #050505; }
        .panel-right { background: #0a0a0a; padding: 20px; }

        /* Speaker Tool */
        .tool-bar { padding: 10px 20px; background: #1a1a1a; border-bottom: 1px solid #333; display: flex; gap: 10px; align-items: center; font-size: 12px;>
        .tool-bar input { background: #000; border: 1px solid #444; color: #fff; padding: 5px; border-radius: 4px; width: 100px; }

        .label { padding: 10px 20px; font-size: 11px; color: #555; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        #transcription-view { flex: 1; padding: 0 20px 20px; overflow-y: auto; white-space: pre-wrap; font-family: 'Fira Code', monospace; color: var(--neo>
        #minutes-view { flex: 1; background: #111; border: 1px solid #222; border-radius: 8px; padding: 20px; overflow-y: auto; color: #ccc; font-size: 14p>

        /* Markdown Table Styling */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th { background: #222; color: var(--accent); padding: 10px; text-align: left; border: 1px solid #333; }
        td { padding: 10px; border: 1px solid #333; }
    </style>
</head>
<body>

    <div class="header">
        <div class="controls">
            <input type="file" id="audioInput" accept="audio/*">
            <button id="startBtn" class="btn-primary">START TRANSCRIBE</button>
        </div>
        <div id="status" style="font-size: 12px; color: #666;">Idle</div>
    </div>

    <div class="progress-container"><div id="progress-bar"></div></div>

    <div class="workspace">
        <div class="panel panel-left">
            <div class="tool-bar">
                <span>Rename:</span> <input type="text" id="findSpk" placeholder="Speaker 1">
                <span>to:</span> <input type="text" id="repSpk" placeholder="Name">
                <button onclick="rename()" class="btn-outline" style="padding: 4px 10px;">Update</button>
            </div>
            <div class="label">Transcription Stream</div>
            <div id="transcription-view">Waiting for upload...</div>
            <div style="padding: 10px 20px;"><button id="dlT" class="btn-outline" style="display:none" onclick="download('transcript')">Download Transcript>
        </div>

        <div class="panel panel-right">
            <div class="label">Bilingual Meeting Minutes</div>
            <div id="minutes-view">The summary will generate here...</div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button id="genBtn" class="btn-success" disabled onclick="generateMinutes()" style="flex:1">GENERATE SUMMARY</button>
                <button id="dlM" class="btn-outline" style="display:none" onclick="download('minutes')">Download Minutes</button>
            </div>
        </div>
    </div>

<script>
    const transcriptionView = document.getElementById('transcription-view');
    const progressBar = document.getElementById('progress-bar');
    const status = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');
    const genBtn = document.getElementById('genBtn');

    let fullTranscript = "";
    let minutesContent = "";

    function setBusy(isBusy) {
        startBtn.disabled = isBusy;
        genBtn.disabled = isBusy || fullTranscript === "";
        status.textContent = isBusy ? "Processing..." : "Idle";
    }

    startBtn.onclick = async () => {
        const file = document.getElementById('audioInput').files[0];
        if (!file) return;

        setBusy(true);
        transcriptionView.textContent = ">>> INITIALIZING ENGINE...\n";
        fullTranscript = "";
        progressBar.style.width = "0%";

        const formData = new FormData();
        formData.append('audio', file);

        const response = await fetch('/transcribe', { method: 'POST', body: formData });
        const reader = response.body.getReader();
        const decoder = new TextDecoder();

        while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            const chunk = decoder.decode(value);

            if (chunk.includes("[[SEGMENT_INFO:")) {
                const match = chunk.match(/SEGMENT_INFO:(\d+)\/(\d+)/);
                if (match) {
                    progressBar.style.width = (match[1] / match[2] * 100) + "%";
                    status.textContent = `Processing Chunk ${match[1]}/${match[2]}`;
                }
                continue;
            }

            fullTranscript += chunk;
            transcriptionView.textContent = fullTranscript;
            transcriptionView.scrollTop = transcriptionView.scrollHeight;
        }

        setBusy(false);

        document.getElementById('dlT').style.display = "block";
        progressBar.style.width = "100%";
    };

    function rename() {
        const f = document.getElementById('findSpk').value;
        const r = document.getElementById('repSpk').value;
        if(!f || !r) return;
        const regex = new RegExp(f, 'gi');
        fullTranscript = fullTranscript.replace(regex, r);
        transcriptionView.textContent = fullTranscript;
    }

    async function generateMinutes() {
        const mv = document.getElementById('minutes-view');
        setBusy(true);
        mv.innerHTML = "<em>⚙️ Drafting minutes based on transcript...</em>";

        const response = await fetch('/generate-minutes', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ transcript: fullTranscript })
        });

        minutesContent = await response.text();
        mv.innerHTML = marked.parse(minutesContent);
        document.getElementById('dlM').style.display = "block";
        setBusy(false);
    }

    function download(type) {
        const text = type === 'transcript' ? fullTranscript : minutesContent;
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `${type}_${Date.now()}.txt`;
        a.click();
    }
</script>
</body>
</html>
























