# Gemini Code Assistant Context

This document provides a comprehensive overview of the "Office Portal" project, its architecture, and operational guidelines.

## Phase 1: Development

The project is currently in the development stage.

## Project Overview

The Office Portal is a full-stack web application designed for internal office use. It features a modern web interface for user authentication, data management (specifically vector embeddings), and interaction with an AI chat service.

- **Frontend:** A responsive Single-Page Application (SPA) built with React.
- **Backend:** A RESTful API service built with Python and FastAPI.
- **Database:** A PostgreSQL database enhanced with the `pgvector` extension for efficient similarity searches on vector data.

## Technologies

| Category      | Technology / Library                                                                                               |
| :------------ | :----------------------------------------------------------------------------------------------------------------- |
| **Backend**   | [FastAPI](https://fastapi.tiangolo.com/), [SQLAlchemy](https://www.sqlalchemy.org/), [pgvector](https://github.com/pgvector/pgvector), [Alembic](https://alembic.sqlalchemy.org/), [pytest](https://docs.pytest.org/) |
| **Frontend**  | [React](https://reactjs.org/), [React Router](https://reactrouter.com/), [Axios](https://axios-http.com/), [Tailwind CSS](https://tailwindcss.com/), [Lucide React](https://lucide.dev/) |
| **Database**  | [PostgreSQL](https://www.postgresql.org/)                                                                          |
| **DevOps**    | [Docker](https://www.docker.com/), [Docker Compose](https://docs.docker.com/compose/), [Nginx](https://www.nginx.com/) |

## Architecture & Services

The application is fully containerized using Docker and managed with Docker Compose.

### Service Diagram (Production)

```
+----------------+       +-------------------+       +-----------------+
|   User/Browser |------>|      Nginx        |------>|  Frontend       |
|                |       |  (Reverse Proxy)  |       |  (React App)    |
+----------------+       |   - Port 80/443   |       +-----------------+
                         +--------+----------+
                                  |
                                  | /api
                                  v
                         +--------+----------+       +-----------------+
                         |      Backend      |<----->|   PostgreSQL    |
                         |   (FastAPI App)   |       | (with pgvector) |
                         +-------------------+       +-----------------+
```

### Services

1.  **`frontend`**:
    -   **Description**: The React-based user interface.
    -   **Build**: Uses the `frontend/Dockerfile`.
    -   **Development**: Runs on `http://localhost:3000` with live-reloading.
2.  **`backend`**:
    -   **Description**: The FastAPI application providing the API.
    -   **Build**: Uses the `backend/Dockerfile`.
    -   **Development**: Runs on `http://localhost:8000` with live-reloading.
3.  **`db`**:
    -   **Description**: The PostgreSQL database service.
    -   **Image**: `pgvector/pgvector:pg15`.
    -   **Data**: Persisted in a Docker volume named `db_data`.
    -   **Initialization**: A custom `init.sql` script is run on first startup to prepare the database.
4.  **`nginx`** (Production only):
    -   **Description**: A reverse proxy that routes incoming traffic to the appropriate service.
    -   **Configuration**: `nginx.conf`.
    -   **Routing**:
        -   `/*` -> `frontend:3000`
        -   `/api/*` -> `backend:8000`
5.  **`test`** (Development only):
    -   **Description**: A non-daemon service to run backend unit tests using `pytest`.

## How to Run

### Prerequisites

-   Docker and Docker Compose installed.
-   A `.env` file created from the `.env.example` template.

### 1. Create `.env` file

Copy `.env.example` to `.env` and fill in the required values.

```sh
cp .env.example .env
```

### 2. Development Mode

This mode uses live-reloading for both frontend and backend code.

```sh
docker-compose up --build
```

-   **Frontend**: `http://localhost:3000`
-   **Backend**: `http://localhost:8000`

### 3. Production Mode

This mode builds optimized containers and runs them behind an Nginx reverse proxy.

```sh
docker-compose -f docker-compose.prod.yml up --build
```

-   **Application**: `http://localhost` (Nginx listens on port 80)

### 4. Running Tests

To run the backend tests, use the `test` profile in the development compose file.

```sh
docker-compose --profile test up --build
```
